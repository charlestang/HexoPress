# 分类详情页面

## 背景与使用场景
- 目前分类管理页（`CategoriesView`）的“查看”操作会在浏览器打开线上站点页面，缺乏在客户端内直观管理分类内容的能力。
- 运营者在梳理分类体系时，常需要快速评估某个分类是否堆积过多文章，并对分类标签做批量整理（例如把“心得体会”细化为“工作心得”等）。
- 当某个父分类下的文章数远大于子分类汇总时，往往说明有大量文章仅挂在父分类下，需要进一步清理或重新归类。

## 目标概述
1. **页面跳转体验**：将“查看”操作改为进入应用内的分类详情页，保持侧边导航对“分类”菜单的高亮，并通过面包屑提供返回入口。
2. **文章列表展示**：在详情页列出目标分类下的文章，默认按更新时间倒序；若缺少更新时间则使用发布时间兜底。
3. **父子分类过滤**：若该分类存在子分类，默认只展示“直接归属于当前分类”的文章；需在页头或空态明确提示“仅显示不含子分类的文章”。父子关系以 FrontMatter 中的二维数组层级（例如 `categories: [["工作相关", "心得体会"]]`）为准；以分类树中被点击的节点作为唯一入口，不会与同名的其他分支混淆。
4. **分类标签管理**：
   - 单篇移除：列表内以 `ElTag` 展示文章的所有分类，标签上的 `X` 可单独移除分类（带二次确认）。
   - 批量重命名：为当前分类提供批量改名入口，将所有关联文章里的该分类名称替换为新名称。
   - 批量删除：提供“一键移除该分类标签”操作，把该分类从所有关联文章中删除。

## 功能与验收细项
- 点击分类列表中的“查看”跳转到 `/categories/:id`（或等价路由），不再打开外部浏览器或弹窗。
- 详情页顶部展示面包屑，如：“分类（共 20 个） << 工作心得（返回分类列表）”；返回按钮跳转回 `CategoriesView`。
- 页面始终保持左侧“分类”菜单高亮。通过列表标题进入文章编辑页后，若用户在编辑器内点击返回，将回到文章列表页（`PostListView`），不会自动回到分类详情页。分类详情页返回 `CategoriesView` 时需要重新刷新分类数据，确保文章数量反映最新结果。

### 数据加载与展示
- 进入详情页立即调用 `window.site.getPosts`（或新增接口），传入 `categoryId` 与 `limit=-1`，获取含草稿与已发布的文章。
- 若分类存在子分类，前端需筛选掉已挂在任一子分类的文章，仅保留直接属于当前分类的文章。
- 列表含以下字段：文章标题（可点击进入编辑页；从编辑器返回会回到文章列表页）、状态（草稿/已发布）、最后更新时间、所属分类列表。
- 列表排序：按更新时间倒序；无更新时间时使用发布时间；两者都缺失的排在末尾。
- 当筛选后的结果为空时，展示“暂无文章（仅显示不含子分类的文章）”提示，可附带受影响文章数（可选）。
- 加载期间显示骨架或 Loading，失败时以 `ElMessage` 告知并保留重试入口。

- **单篇移除**：
  - `ElTag` 使用 `closable` 开启关闭图标，触发时弹出确认对话框，提示将该分类从文章中移除。
  - 确认后调用接口更新该文章的分类列表；成功时立即刷新当前行，若去除的是当前详情分类，则该文章从列表消失。允许文章在移除后没有任何分类；失败时保留原状态并提示错误。
- **批量重命名**：
  - 提供入口（按钮或下拉菜单项）打开对话框输入新分类名。
  - 确认前显示受影响文章数量；若新名称已存在，需提示“是否合并到已有分类”，用户确认后继续。提交后调用批量更新 API，将所有文章中的当前分类名称替换为新名称。
  - 成功后刷新列表与面包屑标题；失败时保持原状态并提示错误。此操作仅调整 FrontMatter 中的分类名称，不额外处理 slug/path。
- **批量删除**：
  - 提供入口执行一键移除操作，确认弹窗需注明影响篇数及不可逆风险。
  - 执行成功后，列表应呈空态，返回分类列表时该分类文章总数为 0（分类节点保留，是否最终删除由用户在分类管理页另行处理）。

## 范围之外
- 不改动分类的创建、层级结构或排序规则。
- 不在详情页提供文章内容编辑、删除等操作（除分类标签管理）。
- 不实现“展示子分类文章”的切换功能；如需此能力，另立需求。

## 技术/实施提示
- 推荐新增独立组件（如 `CategoryPostsView.vue`）与路由记录；确保导航守卫、Pinia 状态等能够识别新页面。
- `window.site.getPosts` 若暂不支持按分类过滤子分类，可前端先取全量再过滤；过滤时依据 FrontMatter 中 `categories` 的嵌套数组（父分类在前，子分类依次排列），与用户在分类树中点击的节点 ID 对比判断是否属于当前分类的子节点。如性能受限，可考虑扩展后端接口提供“仅返回直接分类”选项。
- 移除和批量操作可能复用现有保存文章元信息的逻辑，或新增 IPC/后端接口：
  - `updatePostCategories(postId, categories)` 用于单篇更新。
  - `renameCategory(categoryId, newName)`、`removeCategoryFromAllPosts(categoryId)` 等批量接口，需在 Hexo 数据库层完成同步并保存。
- 操作成功后要刷新前端缓存（列表数据、分类统计、面包屑标题等），避免出现旧数据。批量删除后分类节点保留，仅文章数更新为 0；是否删除分类由用户在分类管理页另行处理。各类批量操作建议显示进度、禁用重复点击，并在结束时提示成功与失败数量。
- 排序策略参考样例仓库：464 篇文章中约 24.6% 含 `updated` 字段、约 97.4% 含 `date` 字段，因此采用“优先按 `updated`，缺失时用 `date`”方案较稳妥；若未来需要切换排序方式，可在后续迭代补充。

## 测试建议
- **手动测试**：
  - 点击多个分类验证路由跳转、面包屑展示与列表加载；包含存在子分类与无子分类的情况。
  - 验证列表仅展示直接挂载的文章，并在空态时提示“仅显示不含子分类的文章”。
  - 测试单篇移除分类：确认弹窗文案、成功后的列表更新、失败场景回滚。
  - 测试批量重命名：核对受影响数量提示、新名称应用于列表与面包屑、失败回滚行为。
  - 测试批量删除：确认列表清空、分类统计更新为 0、返回分类页后的表现。
- **自动化测试**：为组件或路由层增加单元/集成测试，覆盖数据过滤逻辑、标签操作 API 调用、批量操作流程以及导航/返回行为。
- **回归测试**：运行 `npm run lint`、`npm run test`（若存在），确保新增页面不破坏既有功能。
