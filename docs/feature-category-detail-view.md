# 分类详情页面

## 背景与使用场景
- 目前分类管理页（`CategoriesView`）的“查看”操作会在浏览器打开线上站点页面，缺乏在客户端内直观管理分类内容的能力。
- 运营者在梳理分类体系时，常需要快速评估某个分类是否堆积过多文章，并对分类标签做批量整理（例如把“心得体会”细化为“工作心得”等）。
- 当某个父分类下的文章数远大于子分类汇总时，往往说明有大量文章仅挂在父分类下，需要进一步清理或重新归类。

## 目标概述
1. **页面跳转体验**：将“查看”操作改为进入应用内的分类详情页，保持侧边导航对“分类”菜单的高亮，并通过面包屑提供返回入口。
2. **文章列表展示**：在详情页列出目标分类下的文章，默认按更新时间倒序；若缺少更新时间则使用发布时间兜底。
3. **父子分类过滤**：若该分类存在子分类，默认只展示“直接归属于当前分类”的文章；需在页头或空态明确提示“仅显示不含子分类的文章”。父子关系以 FrontMatter 中的二维数组层级（例如 `categories: [["工作相关", "心得体会"]]`）为准；以分类树中被点击的节点作为唯一入口，不会与同名的其他分支混淆。
4. **分类标签管理**：
   - 列表以 `ElTag` 展示完整的分类路径（例如 `工作相关 > PHP`），便于理解文章的归属层级。
   - 批量修改：支持勾选文章后，通过分类树面板统一调整这些文章的分类集合，可新增/替换多级分类。
   - 批量删除：提供“一键移除该分类标签”操作，把该分类从所有关联文章中删除。

## 功能与验收细项
- 点击分类列表中的“查看”跳转到 `/categories/:id`（或等价路由），不再打开外部浏览器或弹窗。
- 详情页顶部展示面包屑，如：“分类（共 20 个） << 工作心得（返回分类列表）”；返回按钮跳转回 `CategoriesView`。
- 页面始终保持左侧“分类”菜单高亮。通过列表标题进入文章编辑页后，若用户在编辑器内点击返回，将回到文章列表页（`PostListView`），不会自动回到分类详情页。分类详情页返回 `CategoriesView` 时需要重新刷新分类数据，确保文章数量反映最新结果。

### 数据加载与展示
- 进入详情页立即调用 `window.site.getPosts`（或新增接口），传入 `categoryId` 与 `limit=-1`，获取含草稿与已发布的文章。
- 若分类存在子分类，前端需依据文章分类对象中的 `_id` 与 `parent` 字段，筛掉挂在任一子分类的文章，仅保留直接属于当前分类的文章，并在页面提示被过滤的子分类文章数量。
- 列表含以下字段：文章标题（可点击进入编辑页；从编辑器返回会回到文章列表页）、状态（草稿/已发布）、最后更新时间、分类路径列表（`父级 > 子级` 形式）。
- 列表排序：按更新时间倒序；无更新时间时使用发布时间；两者都缺失的排在末尾。
- 当筛选后的结果为空时，展示“暂无文章（仅显示不含子分类的文章）”提示，可附带受影响文章数（可选）。
- 加载期间显示骨架或 Loading，失败时以 `ElMessage` 告知并保留重试入口。

- **批量修改分类**：
  - 提供入口（按钮或下拉菜单项）打开分类树弹窗，默认选中当前分类路径。
  - 用户可勾选目标分类（支持多级路径及新增分类），确认前显示受影响文章数量。
  - 确认后调用批量更新 API，将选中文章的分类集合替换为弹窗中选择的结果。
  - 成功后刷新列表与面包屑标题；失败时保持原状态并提示错误。
- **批量删除**：
  - 提供入口执行一键移除操作，确认弹窗需注明影响篇数及不可逆风险。
  - 执行成功后，列表应呈空态，返回分类列表时该分类文章总数为 0（分类节点保留，是否最终删除由用户在分类管理页另行处理）。

## 范围之外
- 不改动分类的创建、层级结构或排序规则。
- 不在详情页提供文章内容编辑、删除等操作（除分类标签管理）。
- 不实现“展示子分类文章”的切换功能；如需此能力，另立需求。

## 技术/实施提示
- 推荐新增独立组件（如 `CategoryPostsView.vue`）与路由记录；确保导航守卫、Pinia 状态等能够识别新页面。
- `window.site.getPosts` 返回的每篇文章包含分类对象数组（含 `_id`、`name`、`parent`），渲染层可据此判断是否直接挂载在当前分类，并生成“父级 > 子级”路径文案；如需进一步优化性能，可考虑扩展后端提供仅返回直接分类文章的选项。
- 批量操作依赖 IPC 接口：`replaceCategoryForPosts(categoryId, sources[], replacements[][])` 与 `removeCategoryFromPosts(categoryId, sources[])`，需确保 HexoAgent 在更新 FrontMatter 后刷新缓存以维持列表与统计的一致性。
- 操作成功后要刷新前端缓存（列表数据、分类统计、面包屑标题等），避免出现旧数据。批量删除后分类节点保留，仅文章数更新为 0；是否删除分类由用户在分类管理页另行处理。各类批量操作建议显示进度、禁用重复点击，并在结束时提示成功与失败数量。
- 排序策略参考样例仓库：464 篇文章中约 24.6% 含 `updated` 字段、约 97.4% 含 `date` 字段，因此采用“优先按 `updated`，缺失时用 `date`”方案较稳妥；若未来需要切换排序方式，可在后续迭代补充。

## 测试建议
- **手动测试**：
  - 点击多个分类验证路由跳转、面包屑展示与列表加载；包含存在子分类与无子分类的情况。
  - 验证列表仅展示直接挂载的文章，并在空态时提示“仅显示不含子分类的文章”。
  - 检查分类列是否以“父级 > 子级”格式展示路径。
  - 测试批量重命名：核对受影响数量提示、新名称应用于列表与面包屑、失败回滚行为。
  - 测试批量删除：确认列表清空、分类统计更新为 0、返回分类页后的表现。
- **自动化测试**：为组件或路由层增加单元/集成测试，覆盖数据过滤逻辑、标签操作 API 调用、批量操作流程以及导航/返回行为。
- **回归测试**：运行 `npm run lint`、`npm run test`（若存在），确保新增页面不破坏既有功能。
