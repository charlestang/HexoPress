# 媒体库图片删除

## 背景
- 媒体库页面（`MediaLibraryView`）展示 Hexo 项目中的所有资源文件，很多图片文件是之前从 WordPress 博客的资源文件迁移过来的，很多没有用的图片。
- 目前界面只支持浏览，无法直接删除图片，用户需要手动切换到文件管理器删除，效率低且容易误删。

## 目标
- 在媒体资源列表中新增“操作”列，并为 `png`/`jpg` 类型的资源提供单个删除入口。
- 对删除操作提供明确的二次确认与风险提示，确保用户知晓可能存在的文章引用。
- 删除后更新实际文件以及 Hexo 资产数据，列表刷新展示最新状态，并给予用户成功/失败反馈。

## 验收标准
- 给定一个 `png` 或 `jpg` 资源行，列表中显示“删除”文本按钮；其他类型资源不展示该操作。
- 当用户点击“删除”按钮时，弹出确认对话框，文案包含“可能有文章引用，删除后导致图片显示为空白”；取消时不触发任何删除请求。
- 用户确认后，前端调用新的删除接口并在等待期间禁用该按钮（或显示加载态）以避免重复提交。
- 删除成功时：
  - 后端删除对应的资源文件并同步更新 Hexo 资产数据，使后续 `getAssets()` 不再返回该记录。
  - 前端重新刷新资源列表，已删除的资源不再出现。
  - 通过 `ElMessage` 提示“删除成功”。
- 删除失败（如文件不存在或文件系统报错）时，前端展示错误提示（`ElMessage`），按钮恢复可点，列表保持原状。

## 范围之外
- 未处理删除后文章引用失效的检测或修复。
- 不支持批量删除、撤销删除、回收站等高级功能。
- 暂不对 `gif`、`svg` 等其他格式开放删除。

## 技术/实施提示
- 需要在 `HexoAgent` 中新增删除能力（例如 `deleteAsset(path: string)`），内部应：
  - 将资源的相对路径转换为磁盘绝对路径并删除文件。
  - 使用 `hexo.database.model('Asset')` 更新或移除对应记录，然后调用 `hexo.database.save()`；若仍读取到旧数据，可回退为调用 `await this.hexo.load()` 重新构建资产缓存。
- 新增 IPC 信道（如 `site:assets-delete`）暴露给渲染进程，返回 Promise，失败时抛出详尽错误信息。
- 前端建议在 `MediaLibraryView.vue` 中扩展 `ElTable` 列定义，使用 `ElMessageBox.confirm` 弹窗，并在操作完成后复用现有的 `getAssets()` 刷新逻辑。
- 注意处理同时删除多个文件的情况：接口应串行执行，前端可在完成一次删除后自动刷新列表以保持数据一致。

## 测试建议
- 手动验证：删除一个未被引用的 png 文件，确认列表刷新与提示符合预期；再尝试删除一个不存在的文件，确认错误提示。
- 自动化：如有端到端测试框架，可加入覆盖删除成功与失败场景的 UI 测试。
- 回归：执行现有 `npm run lint`、`npm run test`（若存在）确保新增代码未破坏现有功能。
