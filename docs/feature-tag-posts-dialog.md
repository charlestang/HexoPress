# 标签相关文章弹窗需求

## 背景
- 目前标签列表页（`TagsView`）中的“查看”操作会通过 `window.site.openUrl` 跳转至站点前台。
- 用户希望在管理后台直接查看该标签下关联的文章列表，避免来回切换页面。
- 目标是提升标签管理体验，并为后续支持更多标签内操作（批量编辑、快速跳转等）奠定基础。

## 目标
1. 在标签列表页点击“查看”时，弹出一个对话框展示该标签下的文章。
2. 对话框内以列表形式呈现文章标题、所属分类与标签信息。
3. 替换原有跳转功能，点击“查看”仅展示弹窗，不再打开站点。

## 术语说明
- **标签**：`Tag`，由 `window.site.getTags()` 返回，包含 `id`、`name`、`permalink`、`length` 等字段。
- **文章**：`Post`，由 `window.site.getPosts()` 返回，包含 `title`、`status`、`date`、`updated`、`permalink`、`tags` 等字段。

## 用户流程
1. 用户进入标签列表页。
2. 点击任意标签行内的“查看”链接。
3. 系统弹出“标签文章列表”对话框：
   - 标题展示“{标签名} · 标签文章（共 N 篇）”，其中 N 等于 `getPosts` 接口返回结果的 `posts.length`。
   - 默认加载文章列表，显示加载状态。
4. 用户可在对话框中浏览文章：
   - 查看文章标题、分类信息（如存在多级分类则展示完整路径）。
   - 查看文章关联的全部标签。
5. 用户关闭弹窗，返回标签列表。

## 详细需求

### 触发与数据加载
- 点击“查看”后拦截默认跳转，改为打开弹窗。
- 传入标签 `id` 与 `name`。
- 弹窗打开时调用数据加载逻辑：
  - 扩展 `window.site.getPosts`，在参数列表中 `keywords` 之后新增可选参数 `tagId`（默认空字符串）；调用方可不传该参数以保持原有行为，传入时过滤包含指定标签的文章。
  - 接口返回符合原 `PostsResults` 结构的全部文章列表，不再额外分页。
- 加载状态显示骨架屏或 Spinner。
- 接口失败时在弹窗内展示错误消息，可重试。

### 列表展示
- 列表字段固定为：
  - 文章标题。
  - 分类信息（复用 `PostListView.vue` 中 `categoryLabelsForPost` 的展示方式）。
  - 标签列表（复用 `PostListView.vue` 中渲染标签的展示方式，如使用 `el-tag` 并在无数据时显示 `--`）。
- 列表以滚动方式展示返回的全部文章，不实现分页。

### 空状态与异常
- 当标签下无文章时，展示空状态插画/文案，例如“暂无文章关联该标签”。
- 加载失败展示错误提示，并提供“重试”按钮。
- 在请求过程中，禁止重复触发加载（按钮置灰）。

### 弹窗交互
- 弹窗支持手动关闭（右上角关闭按钮和取消按钮）。
- 关闭后清理已加载的文章列表与状态，防止下次打开显示旧数据。
- 弹窗宽度建议 ≥ 720px，内容区域允许滚动。
- 支持键盘 ESC 关闭。

## 技术与实现建议
- **组件结构**：
  - 新增 `TagPostsDialog` 组件，负责展示与状态管理。
  - 在 `TagsView` 中引入该组件，使用 `v-model` 控制可见性并传入当前标签信息。
- **数据接口**：
  - 更新 `HexoAgent.getPosts` 与 preload `ISite.getPosts` 类型定义，增加 `tagId` 参数。
  - 所有调用方需调整传参顺序以适配新增参数（特别是传入 `orderBy` / `order` 的场景）。
接口示例：
```typescript
/**
   * Fetch all posts meet the conditions.
   */
  public async getPosts(
    published: boolean = true,
    isDraft: boolean = true,
    limit: number = -1,
    offset: number = 0,
    categoryId: string = '',
    monthCode: string = '',
    keywords: string = '',
    tagId: string = '',
    orderBy: string = 'date',
    order: string = 'desc',
  ): Promise<PostsResults>
```
- 调用示例：`window.site.getPosts(true, true, -1, 0, '', '', '', currentTagId, 'date', 'desc')`
- **状态管理**：
  - 使用 `ref<Post[]>` 存储列表，`ref<boolean>` 管理加载中状态，`ref<string | null>` 持有错误信息。
  - 弹窗关闭时重置状态。
- **复用能力**：
  - 分类、标签文本展示可复用 `PostListView` 中生成路径/标签的辅助函数，必要时抽离至共享模块。

## 验收标准
- 在标签列表页点击“查看”时，不再跳转到外部页面，而是弹出对话框。
- 对话框能正确显示标签名称及文章总数。
- 当标签下存在文章时，列表按照“标题 / 分类 / 标签”三个字段完整展示。
- 空标签、接口错误等场景有明确反馈。
- 弹窗关闭后再次打开可重新加载数据，不残留旧状态。
- 功能与现有国际化系统兼容（新增文案需同时提供中英文）。

## 风险与注意事项
- `getPosts` 按标签过滤可能增加 Hexo 数据库遍历次数，需要评估性能；必要时引入缓存或限制分页。
- 标签数量多时同时发起多个请求可能造成压力，建议防抖或串行请求。
- 需要补充单元测试 / e2e 测试验证弹窗加载逻辑与错误处理。
- 需同步更新用户文档与操作手册，指导用户在后台内查看标签文章。

## 后续拓展
- 在弹窗内支持批量操作（移除标签、批量发布/下线）。
- 为标签提供排序、过滤（按状态、日期）功能。
- 支持导出标签下文章列表。
